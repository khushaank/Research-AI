<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload Research | Research AI Hub</title>

    <link rel="icon" type="image/jpeg" href="assets/favicon.jpg" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        background-color: var(--bg-color);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: auto;
      }

      .admin-container {
        background: white;
        padding: 2.5rem;
        border-radius: 1rem;
        box-shadow:
          0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 8px 10px -6px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        text-align: center;
      }

      h1 {
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      p {
        color: var(--text-secondary);
        margin-bottom: 2rem;
      }

      .upload-area {
        border: 2px dashed #cbd5e1;
        border-radius: 0.75rem;
        padding: 3rem 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 1.5rem;
        background: #f8fafc;
      }

      .upload-area:hover,
      .upload-area.dragover {
        border-color: var(--accent-color);
        background: #eff6ff;
      }

      .upload-icon {
        font-size: 3rem;
        color: #94a3b8;
        margin-bottom: 1rem;
      }

      .btn {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        width: 100%;
        font-size: 1rem;
        transition: background 0.2s;
      }

      .btn:hover {
        background: var(--accent-hover);
      }

      .status-msg {
        margin-top: 1rem;
        font-size: 0.9rem;
        min-height: 1.5em;
      }

      .success {
        color: #10b981;
      }
      .error {
        color: #ef4444;
      }

      /* Hidden file input */
      #file-input {
        display: none;
      }
    </style>

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <body>
    <div class="admin-container">
      <h1>Upload Research</h1>
      <p>Add new papers or images to the repo.</p>

      <div class="upload-area" id="drop-zone">
        <div class="upload-icon">
          <ion-icon name="cloud-upload-outline"></ion-icon>
        </div>
        <div style="font-weight: 500; color: var(--text-primary)">
          Click or Drag files here
        </div>
        <div
          style="
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
          "
        >
          PDF, PNG, JPG, WEBP
        </div>
      </div>

      <input
        type="file"
        id="file-input"
        multiple
        accept=".pdf, .png, .jpg, .jpeg, .webp"
      />

      <div id="status" class="status-msg"></div>

      <div style="margin-top: 1.5rem; font-size: 0.8rem; color: #94a3b8">
        Note: This requires the local server to save files. <br />
        On GitHub Pages, you must commit files manually.
      </div>
    </div>

    <script>
      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const statusDiv = document.getElementById("status");
      const uploadUrl = "/upload"; // Endpoint we will add to server.js

      // Handle Click
      dropZone.addEventListener("click", () => fileInput.click());

      // Handle Drag & Drop
      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.add("dragover"),
          false,
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => dropZone.classList.remove("dragover"),
          false,
        );
      });

      dropZone.addEventListener("drop", handleDrop, false);
      fileInput.addEventListener("change", handleFiles, false);

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles({ target: { files: files } });
      }

      function handleFiles(e) {
        const files = [...e.target.files];
        if (files.length > 0) {
          uploadFiles(files);
        }
      }

      async function uploadFiles(files) {
        statusDiv.textContent = "Uploading...";
        statusDiv.className = "status-msg";

        const formData = new FormData();
        files.forEach((file) => formData.append("files", file));

        try {
          const response = await fetch(uploadUrl, {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const result = await response.json();
            statusDiv.textContent = `Success! ${result.count} file(s) uploaded. Server restarting to update index...`;
            statusDiv.className = "status-msg success";

            // Reset
            setTimeout(() => {
              statusDiv.textContent = "";
            }, 5000);
          } else {
            throw new Error("Upload failed");
          }
        } catch (error) {
          statusDiv.textContent =
            "Error uploading files. Is the server running?";
          statusDiv.className = "status-msg error";
          console.error(error);
        }
      }
    </script>
  </body>
</html>
